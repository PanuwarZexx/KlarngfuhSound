<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>‡∏ß‡∏±‡∏î‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á ‡πÇ‡∏î‡∏¢‡∏Ñ‡∏£‡∏π‡∏Å‡∏•‡∏≤‡∏á</title>

<style>
body{
    margin:0;
    font-family:"Segoe UI",sans-serif;
    background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
    color:white;
    height:100vh;
    overflow:hidden;
}
.wrapper{
    display:flex;
    height:100%;
    padding:30px;
    box-sizing:border-box;
}
.container{flex:3;text-align:center;}
.report-box{
    flex:1;
    margin-left:25px;
    background:rgba(0,0,0,0.45);
    border-radius:20px;
    padding:15px;
    display:flex;
    flex-direction:column;
}
#report{flex:1;overflow-y:auto;font-size:1.1rem;}
.report-item{
    margin-bottom:8px;
    padding-bottom:5px;
    border-bottom:1px dashed rgba(255,255,255,0.2);
}
.report-loud{color:#ff4444;font-weight:bold;}

.title{
    font-size:4rem;
    font-weight:800;
    margin-bottom:30px;
    background:linear-gradient(90deg,#00ffcc,#00aaff,#aa88ff,#ff66aa);
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
}
.buttons{margin-bottom:30px;}
button{
    font-size:1.6rem;
    padding:15px 40px;
    margin:10px;
    border:none;
    border-radius:40px;
    cursor:pointer;
    font-weight:bold;
}
.start{background:linear-gradient(90deg,#00ff88,#00cc66);}
.stop{background:linear-gradient(90deg,#ff4444,#cc0000);color:white;}
.refresh{background:linear-gradient(90deg,#ffaa00,#ff8800);color:white;}

#meter-box{
    width:100%;
    height:90px;
    background:rgba(0,0,0,0.4);
    border-radius:50px;
    overflow:hidden;
}
#meter{
    height:100%;
    width:0%;
    background:linear-gradient(90deg,#00ff88,#ffee00,#ff0033);
}
#status{
    font-size:3rem;
    margin-top:25px;
    font-weight:bold;
}

.circles{
    margin-top:30px;
    display:flex;
    justify-content:center;
    gap:12px;
}
.circle{
    width:22px;
    height:22px;
    border-radius:50%;
    background:white;
}
.circle.red{background:red;}

#alert{
    position:fixed;
    inset:0;
    background:rgba(255,0,0,0.9);
    display:none;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    z-index:999;
}
#alert-text{
    font-size:6rem;
    font-weight:900;
    margin-bottom:40px;
}
#alert button{
    font-size:2rem;
    padding:18px 50px;
    border-radius:50px;
    background:white;
    color:red;
    font-weight:bold;
    cursor:pointer;
}
</style>
</head>

<body>

<div id="alert">
    <div id="alert-text">üö® ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏î‡∏±‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î !!! üö®</div>
    <button onclick="closeAlert()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</button>
</div>

<div class="wrapper">

<div class="container">
    <h1 class="title">üé§ ‡∏ß‡∏±‡∏î‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á<br>‡πÇ‡∏î‡∏¢‡∏Ñ‡∏£‡∏π‡∏≠‡∏∏‡πâ‡∏° ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤‡∏î‡∏µ‡∏°‡∏≤‡∏Å</h1>

    <div class="buttons">
        <button class="start" onclick="startMic()">‚ñ∂ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á</button>
        <button class="stop" onclick="stopMic()">‚èπ ‡∏´‡∏¢‡∏∏‡∏î‡∏ß‡∏±‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á</button>
        <button class="refresh" onclick="refreshAll()">üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button>
    </div>

    <div id="meter-box"><div id="meter"></div></div>
    <div id="status">‚è∏ ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á</div>

    <div class="circles" id="circles"></div>
</div>

<div class="report-box">
    <h2>üìã ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á</h2>
    <div id="report"></div>
</div>

</div>

<script>
let audioContext, analyser, dataArray, stream;
let running=false;
let redIndex=0;
let lastLoud=false;

const circles=[];
const report=document.getElementById("report");
const status=document.getElementById("status");
const meter=document.getElementById("meter");

/* ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ß‡∏á‡∏Å‡∏•‡∏° */
const circleBox=document.getElementById("circles");
for(let i=0;i<15;i++){
    const c=document.createElement("div");
    c.className="circle";
    circleBox.appendChild(c);
    circles.push(c);
}

function log(text,isLoud=false){
    const div=document.createElement("div");
    div.className="report-item";
    if(isLoud) div.classList.add("report-loud");
    div.textContent=new Date().toLocaleTimeString()+" - "+text;
    report.appendChild(div);
    report.scrollTop=report.scrollHeight;
}

async function startMic(){
    if(running) return;
    stream=await navigator.mediaDevices.getUserMedia({audio:true});
    audioContext=new (window.AudioContext||window.webkitAudioContext)();
    analyser=audioContext.createAnalyser();
    analyser.fftSize=256;
    const source=audioContext.createMediaStreamSource(stream);
    dataArray=new Uint8Array(analyser.frequencyBinCount);
    source.connect(analyser);
    running=true;
    log("‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á");
    updateMeter();
}

function stopMic(){
    running=false;
    if(stream) stream.getTracks().forEach(t=>t.stop());
    resetCircles();
    meter.style.width="0%";
    status.textContent="‚èπ ‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á";
    document.getElementById("alert").style.display="none";
    log("‡∏´‡∏¢‡∏∏‡∏î‡∏ß‡∏±‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á");
}

function refreshAll(){
    running=false;
    if(stream) stream.getTracks().forEach(t=>t.stop());
    resetCircles();
    lastLoud=false;
    meter.style.width="0%";
    status.textContent="üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß";
    document.getElementById("alert").style.display="none";
    log("‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏£‡∏∞‡∏ö‡∏ö");
}

function resetCircles(){
    redIndex=0;
    circles.forEach(c=>c.classList.remove("red"));
}

function closeAlert(){
    document.getElementById("alert").style.display="none";
    resetCircles();
    log("‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô");
}

function updateMeter(){
    if(!running) return;

    analyser.getByteFrequencyData(dataArray);
    let avg=dataArray.reduce((a,b)=>a+b,0)/dataArray.length;
    let percent=Math.min(avg*1.5,100);

    meter.style.width=percent+"%";

    /* ===== ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ 3 ‡∏£‡∏∞‡∏î‡∏±‡∏ö (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°) ===== */
    if(percent < 30){
        status.textContent="üü¢ ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏ö‡∏≤";
    }else if(percent < 83){
        status.textContent="üü° ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏°‡∏µ‡πÄ‡∏™‡∏µ‡∏¢‡∏á";
    }else{
        status.textContent="üî¥ ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏î‡∏±‡∏á";
    }

    /* ===== ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ô‡∏±‡∏ö‡∏à‡∏∏‡∏î‡πÅ‡∏î‡∏á (>83 ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô) ===== */
    if(percent > 83){
        if(!lastLoud){
            log("‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏î‡∏±‡∏á",true);
            if(redIndex < 15){
                circles[redIndex].classList.add("red");
                redIndex++;
            }
        }
        lastLoud=true;
    }else{
        if(lastLoud){
            log("‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏ö‡∏≤");
        }
        lastLoud=false;
    }

    if(redIndex >= 15){
        document.getElementById("alert").style.display="flex";
        log("‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏î‡∏±‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î",true);
    }

    requestAnimationFrame(updateMeter);
}
</script>

</body>
</html>
